package cve_query

import (
	"enigma/server/src/common/defs"
	cve_search "enigma/server/src/engine/cveBackend"
	"github.com/labstack/echo/v4"
	"net/http"
)

func getProductsHandler(c echo.Context) error {
	vendorStr := c.QueryParam("vendor")
	if len(vendorStr) == 0 {
		return c.JSON(http.StatusOK, defs.HTTPResponse{
			Code:    defs.REST_CODE_GENERIC_FAILED,
			Msg:     "vendor should be provided for this endpoint",
			Payload: nil,
		})
	}
	productlist, err := cve_search.GetProductlist(G, vendorStr)
	if err == nil {
		return c.JSON(http.StatusOK, defs.SuccessResponse(productlist))
	}

	return c.JSON(http.StatusOK, defs.HTTPResponse{
		Code:    defs.REST_CODE_GENERIC_FAILED,
		Msg:     "failed to get product list for vendor",
		Payload: nil,
	})
}
