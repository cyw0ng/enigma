package cve_query

import (
	"enigma/server/src/common/defs"
)

var G *defs.Global

func RegCVEQuery(GStub *defs.Global) error {
	G = GStub

	G.Echo.GET(REST_GET_VENDORS_ALL, getVendorsAllHandler)
	G.Echo.GET(REST_GET_VENDORS_PARTIAL, getVendorsPartialHandler)
	G.Echo.GET(REST_GET_PRODUCTS, getProductsHandler)
	G.Echo.GET(REST_GET_CVE_V1, getCVEHandlerV1)
	G.Echo.GET(REST_GET_CWELIST_ALL, getCWEAllHandler)
	G.Echo.GET(REST_GET_CAPEC_V1, getCapecAllHandler)
	G.Echo.GET(REST_GET_CIRCLINFO, getCirclCurrentHandler)
	G.Echo.GET(REST_GET_CAPECCOUNT_INDB, getCapecCountHandler)
	G.Echo.GET(REST_CTL_ANALYZE_CAPEC, ctlAnalyzeCapecInfoHandler)

	go func() {
		G.Log.Info("cve_query: start modules background jobs")
		startModuleBgJobs(G)
	}()

	return nil
}
